{% extends "lepidoptera/base.html" %}

{% load page_fragments %}
{% load i18n %}

{% block content %}
    <div class="row">
        <div class="col">
            {% get_page_fragment 'welcome' %}
        </div>
    </div>

    <div class="row">
        <div class="col">
            <h1>{% trans "Quick search" %}</h1>
            <form>
                <label for="multisearch">{% trans "Looking for..." %}</label>
                <input type="text" class="form-control" id="multisearch">
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <h1>{% trans "Overview of all valid families" %}</h1>
        </div>
    </div>

    {% for family in families %}
        {% if forloop.counter0|divisibleby:4 %}
            <div class="row">
        {% endif %}

    <div class="col-sm-3">
        {% include 'lepidoptera/_family_card.html' %}
    </div>

    {% if forloop.counter|divisibleby:4 or forloop.last %}
        </div>
    {% endif %}

    {% endfor %}

{% endblock content %}

{% block bottom-of-body %}
    <script>
        $(function () {
            var compare_suggestion = function (a, b) {
                if (a.value < b.value)
                    return -1;
                if (a.value > b.value)
                    return 1;
                return 0;
            };

            var families = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: '{% url 'search_autocomplete' query_string='QUERY' %}',
                    wildcard: 'QUERY',
                    transform: function (response) {
                        // We have to sort here since the 'sorter' option of Bloodhound doesn't work for remote
                        return response.sort(compare_suggestion);
                    }
                }
            });

            $('#multisearch').typeahead({highlight: true}, {
                name: 'best-pictures',
                display: function (suggestion) {
                    return suggestion.value + '(' + suggestion.suggest_type + ')'
                },
                source: families
            }).bind('typeahead:select', function (ev, suggestion) {
                window.location.replace(suggestion.url);
            });

        });
    </script>
{% endblock %}