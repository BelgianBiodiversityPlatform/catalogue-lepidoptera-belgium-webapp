{% extends "lepidoptera/base.html" %}

{% load page_fragments %}
{% load i18n %}

{% block content %}
    <div class="row">
        <div class="col">
            {% get_page_fragment 'welcome' %}
        </div>
    </div>

    <div class="row">
        <div class="col">
            <h1>{% trans "Quick search" %}</h1>
            <form>
                <label for="multisearch">{% trans "Looking for..." %}</label>
                <input type="text" class="form-control" id="multisearch" placeholder="{% trans "Genus, family, species, host plants, substrates, ..." %}">
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <h1>{% trans "Overview of all valid families" %}</h1>
        </div>
    </div>

    {% for family in families %}
        {% if forloop.counter0|divisibleby:4 %}
            <div class="row">
        {% endif %}

    <div class="col-sm-3">
        {% include 'lepidoptera/_family_card.html' %}
    </div>

    {% if forloop.counter|divisibleby:4 or forloop.last %}
        </div>
    {% endif %}

    {% endfor %}

{% endblock content %}

{% block bottom-of-body %}
    <script>
        $(function () {
            var compare_suggestion = function (a, b) {
                if (a.value < b.value)
                    return -1;
                if (a.value > b.value)
                    return 1;
                return 0;
            };

            var multiSource = new Bloodhound({
                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
                queryTokenizer: Bloodhound.tokenizers.whitespace,
                remote: {
                    url: '{% url 'search_autocomplete' query_string='QUERY' %}',
                    wildcard: 'QUERY',
                    transform: function (response) {
                        // We have to sort here since the 'sorter' option of Bloodhound doesn't work for remote
                        return response.sort(compare_suggestion);
                    }
                }
            });

            $('#multisearch').typeahead({highlight: true}, {
                name: 'multi-search',
                source: multiSource,
                limit: 10,
                templates: {
                    suggestion: function(data){
                        return '<p>' + data.value + ' - ' + '<small class="text-muted">' + data.suggest_type + '</small></p>';
                    },
                }
            }).bind('typeahead:select', function (ev, suggestion) {
                window.location.replace(suggestion.url);
            });

        });
    </script>
{% endblock %}